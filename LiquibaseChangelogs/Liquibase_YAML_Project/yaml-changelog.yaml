databaseChangeLog:
- changeSet:  
    id:  1  
    author:  C.Kleinstein  
    changes:  
    -  renameColumn:  
        catalogName:  customer  
        columnDataType:  text  
        newColumnName:  private_email  
        oldColumnName:  email 
        remarks:  A String  
        schemaName:  public  
        tableName:  customer

- changeSet: 
    id:  2
    author: C.Kleinstein
    changes:
    - addColumn:
        tableName: customer
        columns:
        - column:
            name: gender
            type: varchar(50)
            value: undefined

- changeSet: 
    id:  3
    author: C.Kleinstein
    changes:
    - dropColumn:
        tableName: customer
        columns:
        - column:
            name: gender
    rollback:
        - addColumn:
            tableName: customer
            columns:
            - column:
                name: gender
                type: varchar(50)
                value: undefined

- changeSet:
    id: 4
    author: C.Kleinstein
    changes:  
    -  modifyDataType:    
        columnName:  private_email  
        newDataType:  varchar(100)    
        tableName:  customer
    rollback:
    -  modifyDataType:    
        columnName:  private_email  
        newDataType:  varchar(100)    
        tableName:  customer


- changeSet:
    id: 5
    author: C.Kleinstein
    changes:  
    -  renameTable:   
        newTableName:  clients  
        oldTableName:  customer 
    -  createView:         
        replaceIfExists:  true    
        selectQuery:  SELECT cl.customer_id AS id,
                (cl.first_name || ' '::text) || cl.last_name AS name,
                a.address,
                a.postal_code AS "zip code",
                a.phone,
                city.city,
                country.country,
                    CASE
                        WHEN cl.activebool THEN 'active'::text
                        ELSE ''::text
                    END AS notes,
                cl.store_id AS sid
            FROM clients cl
                JOIN address a ON cl.address_id = a.address_id
                JOIN city ON a.city_id = city.city_id
                JOIN country ON city.country_id = country.country_id;
        viewName:  customer_list
    rollback:
        - sql:
            sql: ALTER TABLE clients RENAME TO customer; 
                CREATE OR REPLACE VIEW customer_list
                AS
                SELECT cu.customer_id AS id,
                (cu.first_name || ' '::text) || cu.last_name AS name,
                a.address,
                a.postal_code AS "zip code",
                a.phone,
                city.city,
                country.country,
                CASE
                WHEN cu.activebool THEN 'active'::text
                ELSE ''::text
                END AS notes,
                cu.store_id AS sid
                FROM customer cu
                JOIN address a ON cu.address_id = a.address_id
                JOIN city ON a.city_id = city.city_id
                JOIN country ON city.country_id = country.country_id;


- changeSet:
    id: 6
    author: C.Kleinstein
    changes:
    -  sql:
        sql: ALTER TABLE address ADD COLUMN house_number text; ALTER TABLE address ADD COLUMN street text; WITH results AS (SELECT address_id as id,(string_to_array(address, ' '))[1] as a1,array_to_string((string_to_array(address, ' '))[2:], ' ') as a2 from address) UPDATE address SET house_number = (SELECT a1 FROM results WHERE address_id = results.id), street = (SELECT a2 FROM results WHERE address_id = results.id);
    rollback:
        - sql:
            sql: ALTER TABLE address DROP COLUMN house_number; ALTER TABLE address DROP COLUMN street;